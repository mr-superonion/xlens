description: The pipeline specialized for testing image simulation.
instrument: lsst.obs.subaru.HyperSuprimeCam

tasks:
  Catalog1:
    class: xlens.simulator.catalog.CatalogShearTask
    config:
      mode: 0
      rotId: 0
      connections.mode: 0
      connections.rotId: 0
  Catalog2:
    class: xlens.simulator.catalog.CatalogShearTask
    config:
      mode: 0
      rotId: 1
      connections.mode: 0
      connections.rotId: 1
  Catalog3:
    class: xlens.simulator.catalog.CatalogShearTask
    config:
      mode: 1
      rotId: 0
      connections.mode: 1
      connections.rotId: 0
  Catalog4:
    class: xlens.simulator.catalog.CatalogShearTask
    config:
      mode: 1
      rotId: 1
      connections.mode: 1
      connections.rotId: 1
  MutibandSim1:
    class: xlens.simulator.sim.MultibandSimTask
    config:
      survey_name: hsc
      rotId: 0
      connections.mode: 0
      connections.rotId: 0
  MutibandSim2:
    class: xlens.simulator.sim.MultibandSimTask
    config:
      survey_name: hsc
      rotId: 1
      connections.mode: 0
      connections.rotId: 1
  MutibandSim3:
    class: xlens.simulator.sim.MultibandSimTask
    config:
      survey_name: hsc
      rotId: 0
      connections.mode: 1
      connections.rotId: 0
  MutibandSim4:
    class: xlens.simulator.sim.MultibandSimTask
    config:
      survey_name: hsc
      rotId: 1
      connections.mode: 1
      connections.rotId: 1

  AnacalDetectTask1:
    class: xlens.process_pipe.anacal_detect.AnacalDetectPipe
    config:
      anacal.num_epochs: 3
      anacal.do_noise_bias_correction: False
      anacal.validate_psf: True
      connections.coaddName: sim_0_rot0_
  AnacalDetectTask2:
    class: xlens.process_pipe.anacal_detect.AnacalDetectPipe
    config:
      anacal.num_epochs: 3
      anacal.do_noise_bias_correction: False
      anacal.validate_psf: True
      connections.coaddName: sim_0_rot1_
  AnacalDetectTask3:
    class: xlens.process_pipe.anacal_detect.AnacalDetectPipe
    config:
      anacal.num_epochs: 3
      anacal.do_noise_bias_correction: False
      anacal.validate_psf: True
      connections.coaddName: sim_1_rot0_
  AnacalDetectTask4:
    class: xlens.process_pipe.anacal_detect.AnacalDetectPipe
    config:
      anacal.num_epochs: 3
      anacal.do_noise_bias_correction: False
      anacal.validate_psf: True
      connections.coaddName: sim_1_rot1_

  AnacalForceTask1:
    class: xlens.process_pipe.anacal_force.AnacalForcePipe
    config:
      fpfs.sigma_shapelets1: 0.52
      anacal.do_noise_bias_correction: False
      connections.coaddName: sim_0_rot0_
  FpfsForceTask1:
    class: xlens.process_pipe.fpfs_force.FpfsForcePipe
    config:
      fpfs.sigma_shapelets1: 0.52
      fpfs.do_noise_bias_correction: False
      connections.coaddName: sim_0_rot0_
  FpfsForceTask2:
    class: xlens.process_pipe.fpfs_force.FpfsForcePipe
    config:
      fpfs.sigma_shapelets1: 0.52
      fpfs.do_noise_bias_correction: False
      connections.coaddName: sim_0_rot1_
  FpfsForceTask3:
    class: xlens.process_pipe.fpfs_force.FpfsForcePipe
    config:
      fpfs.sigma_shapelets1: 0.52
      fpfs.do_noise_bias_correction: False
      connections.coaddName: sim_1_rot0_
  FpfsForceTask4:
    class: xlens.process_pipe.fpfs_force.FpfsForcePipe
    config:
      fpfs.sigma_shapelets1: 0.52
      fpfs.do_noise_bias_correction: False
      connections.coaddName: sim_1_rot1_

  SelectBiasTask:
    class: xlens.analysis.selbias.SelBiasMultibandPipe
    config:
      shape_name: "fpfs_e1"
      dshape_name: "fpfs_de1"
      flux_name: "flux"
      dflux_name: "dflux"
      weight_name: "wsel"
      dweight_name: "dwsel"
      do_correct_selection_bias: True
      connections.dataType: anacal_joint
      connections.coaddName: sim
  Summary:
    class: xlens.analysis.selbias.SelBiasSummaryMultibandPipe
    config:
      connections.dataType: anacal_joint
      connections.coaddName: sim
  # SelectBiasTask2:
  #   class: xlens.analysis.selbias.SelBiasMultibandPipe
  #   config:
  #     shape_name: "i_fpfs1_e1"
  #     dshape_name: "i_fpfs1_de1"
  #     flux_name: "flux"
  #     dflux_name: "dflux"
  #     weight_name: "wsel"
  #     dweight_name: "dwsel"
  #     do_correct_selection_bias: True
  #     connections.dataType: fpfs_force
  #     connections.coaddName: sim
  # Summary2:
  #   class: xlens.analysis.selbias.SelBiasSummaryMultibandPipe
  #   config:
  #     connections.dataType: fpfs_force
  #     connections.coaddName: sim
